---
title: 'Pop2net'
bibliography: paper.bib
---

# Introduction
Agent-based modeling is a scientific method used in fields such as social science, biology, and ecology to simulate the interactions of autonomous agents and study the resulting emergent phenomena (CITE?).
Relationships between agents, which structure the simulated interactions, are often represented by network graphs.
Since empirical data on networks is rare, most of agent-based models rely on artificially generated networks [@amblard_which_2015].
Consequently, generating a valid network structure at the beginning of a simulation, as well as accessing and modifying it during the simulation, are critical steps that must be managed in almost every agent-based model.

Pop2net is a Python package that bundles all steps related to network generation and management for agent-based modeling.
In Pop2net, relationships between agents are represented as a bipartite graph of agents and locations.
Locations act as a contact layer, representing specific contexts through which agents connect.
This makes it easy to generate and to manage custom network structures in an agent-based model.
Pop2net is mainly an extension to the existing agent-based modeling framework AgentPy [@foramitti_agentpy_2021], but can also be used to generate networks for other modeling frameworks.

# Statement of Need

Currently, there are only a few tools exist designed to create and manage networks for agent-based modeling.
General purpose agent-based modeling packages such as Mesa [@kazil_utilizing_2020], AgentPy [@foramitti_agentpy_2021] or Melodie [@yu_melodie_2023] provide basic data types to represent networks, but lack tools to create these network structures.
Existing network generators explicitly designed for agent-based modeling, such as SynthPops (CITE), lack of generalization and are often domain-specific and limited in scope.
Thus, most agent-based models rely on highly abstract network models, e.g. using NetworkX in Python [@hagberg_exploring_2008], and randomly placing agents within these graphs [@amblard_which_2015].
This approach not only generates networks with low realism regarding the edges, but also ignores correlations between agent attributes and network positions.
Custom modifications of these network models to adapt the network to the research design are often complicated and inflexible.

Pop2net aims to fill this gap in the toolbox of agent-based modelers by providing a framework for creating and managing custom network structures while integrating empirical data and traditional network models.
In the following, we describe the core features of Pop2net that are currently lacking in existing tools.

Using Pop2net's LocationDesigner and Creator classes, agent-based modelers can easily and flexibly generate custom network structures by defining different location types.
Location type definitions specify, for example, which agents are connected to a location, how many location instances should be created, whether locations are nested within other locations, or how strongly the connection between an agent and a location is weighted.
Based on these definitions, the Creator class generates a bipartite network of agents and locations.
Designing networks based on multiple location type definitions provides a highly modular approach to network generation, making it easy to modify and scale network structures.
Location types can also incorporate network graphs based on empirical data or generated by NetworkX.
The approach of creating a network based on agents and locations is not entirely new, but is already common in epidemiological agent-based models (CITE?).
However, Pop2net is the first software package to implement this approach in a general package for network generation and management in agent-based modeling.

<!-- LE: should this still be 'statement of need'? -->
Pop2net is designed to integrate empirical micro-level data of simulated entities into the population and network generation processes.
The Creator class provides tools to first generate a population of agents based on survey data (or any other micro-level dataset) and then use these empirical attributes when defining location types.
This enables users to ground network generation in empirical data, even in the absence of detailed micro-level network information.

The bipartite network structure in Pop2net simplifies relationship management during simulations.
Each location type represents a specific class of relationships between agents, making it easy to target or modify specific relationship types.
While in pure agent-level networks it becomes difficult to distinguish between different types of relations or contexts, locations are an intuitive way to think about, label, or distinguish relations between agents.
For example, finding contacts from a particular context or modifying a particular type of relation (by modifying the corresponding location) becomes a simple task.

Pop2net extends AgentPy by seamlessly integrating its features.
Networks built with Pop2net can be used directly for simulations within AgentPy.
Additionally, users can integrate Pop2net objects into custom simulation frameworks or export the generated networks as NetworkX graphs, either in their bipartite form or as a pure agent-level projection.

In addition, Pop2net includes tools to quickly analyze the properties of the generated networks.
These tools ensure that the generated networks meet the intended specifications and proportions.

# Software structure
<!-- LE: We are NOT technically a fork of AgentPy! We depend on AgentPy and vendor in a single object for modification

Technically, Pop2net is a fork of AgentPy that modifies some of AgentPy's core object classes and adds additional object classes to the existing framework.
-->
In Pop2net, the core object classes that must be used are Model, Agent, and Location.
The Model class is largely identical to the AgentPy Model class, which holds all entities and parameters of the simulation while defining and executing the simulation procedure.
In Pop2net, the Model object is extended by the following features:

* A graph object that stores all agents and locations as well as their relationships.
* An agent list and a location list that provide convenient access to agent and location objects.
* Various methods for managing tasks such as connecting agents and locations or exporting the network.

Agents are the (inter)acting entities of the simulation.
They extend AgentPy's agent class by adding methods to, for example, access all locations that the agent is associated with, find neighbors within certain location types or connect them to other agents via certain locations.

Locations represent the places or contexts in which agents interact.
In Pop2net, every connection between agents must be mediated by a location.

In addition to these three core object classes that enable basic network creation and simulation, Pop2net introduces three additional object classes that enhance network generation and validation.
The Creator, in combination with the LocationDesigner, facilitates the flexible creation of agents and locations and their connections as defined by the LocationDesigner class.
The Inspector class provides methods for quick network analysis, such as visualization and the calculation of network measures.


![](software_structure.png)


# Example code

# Acknowledgements

# References
